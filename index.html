<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>360° Navigation Example</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>

<body>
    <a-scene>
        <!-- Preload images -->
        <a-assets>
            <img id="image1" src="img/コントロール.png">
            <img id="image2" src="img/コントロール1.png">
            <img id="image3" src="img/エレベータ.png">
            <img id="image4" src="img/コントロール2.png">
            <img id="image5" src="img/廊下左.png">
            <img id="image6" src="img/廊下右.png">
            <img id="image7" src="img/コントロール3.png">
            <img id="image8" src="img/エレベータ2.png">
            <img id="image9" src="img/コントロール4.png">
            <img id="image10" src="img/情報上.png">
            <img id="image11" src="img/情報下.png">
            <img id="image12" src="img/教育.png">
            <img id="image13" src="img/回復.png">
            <img id="image14" src="img/中央上.png">
            <img id="image15" src="img/福祉上.png">
            <img id="image16" src="img/懲戒上.png">
            <img id="image17" src="img/エレベータ.png">
            <img id="image18" src="img/エレベータ2.png">
            <img id="image19" src="img/福祉下.png">
            <img id="image20" src="img/懲戒下.png">
            <img id="image21" src="img/中央下.png">
            <img id="image22" src="img/記録.png">
            <img id="image23" src="img/抽出.png">
            <img id="image24" src="img/カルメン.png">
            <img id="image25" src="img/最後.png">

            <!-- Preload choice images -->
            <img id="choiceImage1" src="img/情報上.png">
            <img id="choiceImage2" src="img/廊下右.png">
            <img id="choiceImage3" src="img/教育.png">
            <img id="choiceImage4" src="img/コントロール3.png">
            <img id="choiceImage5" src="img/回復.png">
            <img id="choiceImage6" src="img/コントロール2.png">
            <img id="choiceImage7" src="img/廊下左.png">
            <img id="choiceImage8" src="img/中央上.png">

            <img id="choiceImage9" src="img/福祉上.png">
            <img id="choiceImage10" src="img/懲戒上.png">
            <img id="choiceImage11" src="img/福祉下.png">
            <img id="choiceImage12" src="img/懲戒下.png">
            <img id="choiceImage13" src="img/記録.png">
            <img id="choiceImage14" src="img/抽出.png">
            <img id="choiceImage15" src="img/最後.png">
            <img id="choiceImage17" src="img/情報下.png">
        </a-assets>

        <!-- Initial 360-degree image -->
        <a-sky id="sky" src="#image1"></a-sky>

        <!-- Camera with cursor, WASD movement disabled -->
        <a-camera position="0 1.6 0" wasd-controls="false">
            <a-cursor></a-cursor>
        </a-camera>

        <!-- Next hotspot -->
        <a-entity id="nextHotspot" geometry="primitive: circle; radius: 1" material="color: red; opacity: 0.3"
            position="5 0 0" rotation="-90 0 0"></a-entity>

        <!-- Previous hotspot -->
        <a-entity id="prevHotspot" geometry="primitive: circle; radius: 1" material="color: blue; opacity: 0.3"
            position="-5 0 0" rotation="-90 0 0"></a-entity>

        <!-- Choice hotspots (initially hidden) -->
        <a-image id="choice1" src="#choiceImage1" position="0 2 -3" rotation="0 0 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice2" src="#choiceImage2" position="0 2 3" rotation="0 0 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice2.1" src="#choiceImage7" position="0 2 3" rotation="0 0 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice3" src="#choiceImage3" position="3 2 0" rotation="0 -90 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice4" src="#choiceImage4" position="-3 2 0" rotation="0 -90 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice5" src="#choiceImage5" position="-3 2 0" rotation="0 -90 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice6" src="#choiceImage6" position="3 2 0" rotation="0 -90 0" scale="1.5 1.5 0"
            visible="false"></a-image>

        <a-image id="choice7" src="#choiceImage8" position="0 2 -3" rotation="0 0.1 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice8" src="#choiceImage17" position="0 2 -3" rotation="0 -0.1 0" scale="1.5 1.5 0"
            visible="false"></a-image>

        <a-image id="choice9" src="#choiceImage9" position="0 2 -3" rotation="0 0 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice10" src="#choiceImage10" position="0 2 -3" rotation="0 0 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice11" src="#choiceImage11" position="0 2 3" rotation="0 0 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice12" src="#choiceImage12" position="0 2 3" rotation="0 0 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice13" src="#choiceImage13" position="-3 2 0" rotation="0 -90 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice14" src="#choiceImage14" position="-3 2 0" rotation="0 -90 0" scale="1.5 1.5 0"
            visible="false"></a-image>
        <a-image id="choice15" src="#choiceImage15" position="3 2 0" rotation="0 -90 0" scale="1.5 1.5 0"
            visible="false"></a-image>
    </a-scene>

    <script>
        let currentImageIndex = 0;
        const images = ['#image1', '#image2', '#image3', '#image8', '#image4', '#image7', '#image3', '#image8', '#image10', '#image3',
            '#image5', '#image11', '#image6', '#image8', '#image3', '#image12', '#image3', '#image8', '#image13', '#image17',
            '#image15', '#image14', '#image16', '#image18', '#image17', '#image19', '#image21', '#image20', '#image18', '#image17',
            '#image22', '#image24', '#image23', '#image18', '#image17', '#image25', '#image18', '#image8', '#image9'];

        // 選択肢ホットスポットと対応する画像インデックスを定義
        const choiceHotspots = [
            { id: 'choice1', targetIndex: 8 },
            { id: 'choice2', targetIndex: 12 },
            { id: 'choice3', targetIndex: 15 },
            { id: 'choice4', targetIndex: 5 }
        ];
        const choiceHotspots2 = [
            { id: 'choice1', targetIndex: 8 },
            { id: 'choice2.1', targetIndex: 10 },
            { id: 'choice5', targetIndex: 18 },
            { id: 'choice6', targetIndex: 4 }
        ];
        const choiceHotspots3 = [
            { id: 'choice7', targetIndex: 21 }
        ];
        const choiceHotspots4 = [
            { id: 'choice8', targetIndex: 11 }
        ];
        const choiceHotspots5 = [
            { id: 'choice9', targetIndex: 20 },
            { id: 'choice11', targetIndex: 25 },
            { id: 'choice13', targetIndex: 30 },
            { id: 'choice15', targetIndex: 35 }
        ];
        const choiceHotspots6 = [
            { id: 'choice10', targetIndex: 22 },
            { id: 'choice12', targetIndex: 27 },
            { id: 'choice14', targetIndex: 32 },
            { id: 'choice15', targetIndex: 35 }
        ];
        function changeImage(indexChange) {
            currentImageIndex = (currentImageIndex + indexChange + images.length) % images.length;
            document.getElementById('sky').setAttribute('src', images[currentImageIndex]);

            const isChoiceVisible3 = images[currentImageIndex] === '#image3';
            const isChoiceVisible8 = images[currentImageIndex] === '#image8';
            const isChoiceVisible10 = images[currentImageIndex] === '#image11';
            const isChoiceVisible11 = images[currentImageIndex] === '#image14';
            const isChoiceVisible20 = images[currentImageIndex] === '#image17';
            const isChoiceVisible21 = images[currentImageIndex] === '#image18';

            document.getElementById('nextHotspot').setAttribute('visible', !(isChoiceVisible3 || isChoiceVisible8 || isChoiceVisible20 || isChoiceVisible21));
            document.getElementById('prevHotspot').setAttribute('visible', !(isChoiceVisible3 || isChoiceVisible8 || isChoiceVisible20 || isChoiceVisible21));

            const activeChoiceHotspots = isChoiceVisible3 ? choiceHotspots : isChoiceVisible8 ? choiceHotspots2 : isChoiceVisible10 ? choiceHotspots3 : isChoiceVisible11 ? choiceHotspots4 : isChoiceVisible20 ? choiceHotspots5 : isChoiceVisible21 ? choiceHotspots6 : [];

            // 全ての選択肢ホットスポットを非表示し、画面外に移動
            [...choiceHotspots, ...choiceHotspots2, ...choiceHotspots3, ...choiceHotspots4, ...choiceHotspots5, ...choiceHotspots6].forEach(({ id }) => {
                const choiceElement = document.getElementById(id);
                if (choiceElement) {
                    choiceElement.setAttribute('visible', false);
                    choiceElement.setAttribute('position', '0 -50 0'); // 画面外に移動
                    choiceElement.onclick = null; // イベントリスナーをリセット
                }
            });

            // アクティブな選択肢を表示し、元の座標に戻す
            activeChoiceHotspots.forEach(({ id, targetIndex }) => {
                const choiceElement = document.getElementById(id);
                if (choiceElement) {
                    choiceElement.setAttribute('visible', true);
                    // 必要に応じて元の座標を指定
                    const originalPosition = {
                        'choice1': '0 2 -3',
                        'choice2': '0 2 3',
                        'choice2.1': '0 2 3',
                        'choice3': '3 2 0',
                        'choice4': '-3 2 0',
                        'choice5': '-3 2 0',
                        'choice6': '3 2 0',
                        'choice7': '0 2 -3',
                        'choice8': '0 2 -3',
                        'choice9': '0 2 -3',
                        'choice10': '0 2 -3',
                        'choice11': '0 2 3',
                        'choice12': '0 2 3',
                        'choice13': '-3 2 0', // choice13を追加
                        'choice14': '-3 2 0',
                        'choice15': '3 2 0'  // choice15を追加
                    };
                    if (originalPosition[id]) {
                        choiceElement.setAttribute('position', originalPosition[id]);
                    }
                    choiceElement.onclick = () => setSkyImage(targetIndex);
                }
            });
        }




        function setSkyImage(imageIndex) {
            console.log(`Changing to image index: ${imageIndex}`);
            console.log(`Current choice hotspots:`, choiceHotspots5, choiceHotspots6);

            currentImageIndex = imageIndex;
            document.getElementById('sky').setAttribute('src', images[currentImageIndex]);

            [...choiceHotspots, ...choiceHotspots2, ...choiceHotspots3, ...choiceHotspots4, ...choiceHotspots5, ...choiceHotspots6].forEach(({ id }) => {
                const choiceElement = document.getElementById(id);
                if (choiceElement) {
                    choiceElement.setAttribute('visible', false);
                    choiceElement.onclick = null;
                } else {
                    console.error(`Element with id "${id}" not found!`);
                }
            });

            document.getElementById('nextHotspot').setAttribute('visible', true);
            document.getElementById('prevHotspot').setAttribute('visible', true);
        }



        // イベントリスナーの設定
        document.getElementById('nextHotspot').addEventListener('click', () => changeImage(1));
        document.getElementById('prevHotspot').addEventListener('click', () => changeImage(-1));

    </script>

</body>

</html>
